<!DOCTYPE html>
<html>
<head>
    <title>Manual Cart Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        .test-btn { background: #4CAF50; color: white; border: none; padding: 10px 20px; margin: 10px; border-radius: 5px; cursor: pointer; }
        .test-btn:hover { background: #45a049; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üõí Manual Cart Test</h1>
    
    <h3>Step 1: Login Test</h3>
    <button class="test-btn" onclick="testLogin()">Quick Login (testuser/test123)</button>
    <div id="loginResult" class="result"></div>
    
    <h3>Step 2: Add Test Item to Cart</h3>
    <button class="test-btn" onclick="addTestItem()">Add Tomatoes to Cart</button>
    <div id="addResult" class="result"></div>
    
    <h3>Step 3: View Cart</h3>
    <button class="test-btn" onclick="viewCart()">View Cart Contents</button>
    <div id="cartResult" class="result"></div>
    
    <h3>Step 4: Open Main Site</h3>
    <button class="test-btn" onclick="openMainSite()">Open Enhanced Garden E-Commerce</button>

    <script>
        let testUser = null;

        function testLogin() {
            fetch('/gar/LoginServlet', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'username=testuser&password=test123'
            })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('loginResult');
                if (data.success) {
                    testUser = {
                        id: data.user_id,
                        username: data.username,
                        fullName: data.full_name
                    };
                    resultDiv.innerHTML = `‚úÖ Login successful! User: ${data.full_name} (ID: ${data.user_id})`;
                } else {
                    resultDiv.innerHTML = `‚ùå Login failed: ${data.message}`;
                }
            })
            .catch(error => {
                document.getElementById('loginResult').innerHTML = `‚ùå Error: ${error}`;
            });
        }

        function addTestItem() {
            if (!testUser) {
                alert('Please login first!');
                return;
            }
            
            fetch('/gar/CartServlet', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'action=add&product_id=1&quantity=2'
            })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('addResult');
                if (data.success) {
                    resultDiv.innerHTML = `‚úÖ Added 2 Tomatoes to cart successfully!`;
                } else {
                    resultDiv.innerHTML = `‚ùå Failed to add to cart: ${data.message}`;
                }
            })
            .catch(error => {
                document.getElementById('addResult').innerHTML = `‚ùå Error: ${error}`;
            });
        }

        function viewCart() {
            if (!testUser) {
                alert('Please login first!');
                return;
            }
            
            fetch('/gar/CartServlet')
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('cartResult');
                if (data.success) {
                    if (data.cart_items && data.cart_items.length > 0) {
                        let html = `<h4>Cart Contents:</h4>`;
                        data.cart_items.forEach(item => {
                            html += `<div>‚Ä¢ ${item.name} - ‚Çπ${item.price} √ó ${item.quantity} = ‚Çπ${item.total}</div>`;
                        });
                        html += `<div><strong>Total: ‚Çπ${data.total_amount}</strong></div>`;
                        html += `<div><strong>Item Count: ${data.item_count}</strong></div>`;
                        resultDiv.innerHTML = html;
                    } else {
                        resultDiv.innerHTML = `‚úÖ Cart is empty`;
                    }
                } else {
                    resultDiv.innerHTML = `‚ùå Error loading cart: ${data.message}`;
                }
            })
            .catch(error => {
                document.getElementById('cartResult').innerHTML = `‚ùå Error: ${error}`;
            });
        }

        function openMainSite() {
            window.open('/gar/enhanced-garden-ecommerce/', '_blank');
        }
    </script>
</body>
</html>
